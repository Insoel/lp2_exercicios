## Problema

22 - Cria as seguintes classes:

*   Classe `AddManager`, com uma única propriedade de nome `Total` do tipo
    `int`. Esta classe deve ser um _singleton_ com inicialização _lazy_, e
    tanto a sua inicialização como o acesso à propriedade `Total` devem ser
    _thread-safe_.
*   Classe `Adder`, com o método `LetsAdd()`, que cria e lança uma _thread_ que
    adiciona 1000 inteiros aleatórios entre 0 e 100 à propriedade `Total` da
    instância solitária de `AddManager`. A classe tem também a propriedade
    auto-implementada `Partial`, na qual a _thread_ guarda o total parcial
    relativo aos inteiros que somou. O método `LetsAdd()` retorna a instância
    da _thread_ criada e lançada.
*   Classe `Program`, com o método `Main()`, no qual: a) são criadas 20
    instâncias de `Adder`; b) é invocado o método `LetsAdd()` em cada delas,
    sendo mantidas referência às _threads_ devolvidas; c) é feita uma espera
    (com _join_) em todas as _threads_ devolvidas; d) é realizada e mostrada no
    ecrã a soma do `Partial` de todas as instâncias de `Adder`; e) é mostrado
    no ecrã o valor `Total` da instância solitária de `AddManager`; e, f) é
    indicado no ecrã se as somas são iguais ou não.

Nota que, para o programa estar correto, as somas devem ser sempre iguais.

## Solução

```cs
using System;
using System.Threading;

namespace LP2_Exercicios
{
    public class Program
    {
        public static Random Rand { get; } = Rand = new Random();

        static void Main(string[] args)
        {
            int total, partial;

            /* Instantiate Adder vars */
            Adder a1 = new Adder();
            Adder a2 = new Adder();
            Adder a3 = new Adder();
            Adder a4 = new Adder();
            Adder a5 = new Adder();
            Adder a6 = new Adder();
            Adder a7 = new Adder();
            Adder a8 = new Adder();
            Adder a9 = new Adder();
            Adder a10 = new Adder();
            Adder a11 = new Adder();
            Adder a12 = new Adder();
            Adder a13 = new Adder();
            Adder a14 = new Adder();
            Adder a15 = new Adder();
            Adder a16 = new Adder();
            Adder a17 = new Adder();
            Adder a18 = new Adder();
            Adder a19 = new Adder();
            Adder a20 = new Adder();

            Thread t1 = a1.LetsAdd();
            Thread t2 = a2.LetsAdd();
            Thread t3 = a3.LetsAdd();
            t1.Join();
            t2.Join();
            t3.Join();
            Thread t4 = a4.LetsAdd();
            t4.Join();
            Thread t5 = a5.LetsAdd();
            t5.Join();
            Thread t6 = a6.LetsAdd();
            t6.Join();
            Thread t7 = a7.LetsAdd();
            t7.Join();
            Thread t8 = a8.LetsAdd();
            t8.Join();
            Thread t9 = a9.LetsAdd();
            t9.Join();
            Thread t10 = a10.LetsAdd();
            t10.Join();
            Thread t11 = a11.LetsAdd();
            t11.Join();
            Thread t12 = a12.LetsAdd();
            t12.Join();
            Thread t13 = a13.LetsAdd();
            t13.Join();
            Thread t14 = a14.LetsAdd();
            t14.Join();
            Thread t15 = a15.LetsAdd();
            t15.Join();
            Thread t16 = a16.LetsAdd();
            t16.Join();
            Thread t17 = a17.LetsAdd();
            t17.Join();
            Thread t18 = a18.LetsAdd();
            t18.Join();
            Thread t19 = a19.LetsAdd();
            t19.Join();
            Thread t20 = a20.LetsAdd();
            t20.Join();

            partial = a1.Partial + a2.Partial + a3.Partial + a4.Partial + a5.Partial
                + a6.Partial + a7.Partial + a8.Partial + a9.Partial + a10.Partial +
                 a11.Partial + a12.Partial + a13.Partial + a14.Partial + a15.Partial
                 + a16.Partial + a17.Partial + a18.Partial + a19.Partial + a20.Partial;

            Console.WriteLine($"Sum of all partial sums from Adder classes: {partial}");

            total = AddManager.Instance.Total;

            Console.WriteLine($"Total value from AddManager singleton instance: {total}");

            if (total == partial)
                Console.WriteLine("Somas são iguais!");
            else
                Console.WriteLine("Somas não são iguais :(");
        }
    }
}
```

```cs
namespace LP2_Exercicios
{
    public class AddManager
    {
        /* Unique instance, private */
        private static AddManager instance;
        /* Lock */
        private static readonly object threadLock = new object();

        /* Singleton property */
        public static AddManager Instance
        {
            get
            {
                lock (threadLock)
                {
                    if (instance == null)
                        instance = new AddManager();
                    return instance;
                }
            }
        }

        /* Total property */
        public int Total
        {
            get
            {
                lock(threadLock)
                {
                    return Total;
                }
            }
            set
            {
                lock(threadLock)
                {
                    Total = value;
                }
            }
        }
    }
}
```

```cs
using System.Threading;

namespace LP2_Exercicios
{
    public class Adder
    {
        /* Partial values from thread sum */
        public int Partial { get; private set; }


        /* Create, start and return thread */
        public Thread LetsAdd()
        {
            Thread thread = new Thread(AddNumbers);
            thread.Start();

            return thread;
        }

        /* Method used by thread to sum numbers */
        public void AddNumbers()
        {
            /* var that holds random value */
            int value;
            for (int i = 0; i < 1000; i++)
            {
                /* Get random value from 0 to 100 */
                value = Program.Rand.Next(0, 101);
                /* Add that value to Partial property and to Total (on singleton class) */
                AddManager.Instance.Total += value;
                Partial += value;
            }
        }
    }
}
```